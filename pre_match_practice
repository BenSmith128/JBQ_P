# List questions in an easily usable format

WITH tep AS (
  SELECT
    Book_num,
    Qq_wc,
    Qa_pre_brdg,
    QA_wrd_count,
    Qi_qab_wc,
    Ans_wc,
    Qq_f2,
    Q_asked,
    Qa_b,
    Qi_b,
    Qi,
    Book_name,
    Ans_ch,
    Ans_fvs,
    --delete for 10_points
    Ans_Lvs,
    --delete for 10_points
    Answer
  FROM `?_pts` --point value SQL created table
)

SELECT
  Book_num,
  CONCAT(IFNULL(Qq_f2, ''), ' ', IFNULL(Q_asked, ''), ' ', Qa_b) AS Ques_ask,
  CONCAT(IFNULL(Qi_b, ''), ' ', IFNULL(Qi, '')) AS Ques_int,
  CASE
    WHEN Book_name IS NOT NULL AND Ans_ch IS NOT NULL AND Ans_fvs IS NOT NULL THEN
      CONCAT(
        Book_name, ' ', 
        Ans_ch, ':', 
        Ans_fvs,
        -- delete this CASE for 10_points
        CASE
          WHEN Ans_Lvs IS NOT NULL
          THEN CONCAT('-', CAST(Ans_Lvs AS STRING))
          ELSE '' 
        END,
        -- delete this CASE for 10_points
        ' '
      )
    ELSE ''
  END 
  || Answer AS Answ,
  Qq_wc,
  (COALESCE(Qq_wc, 0) + COALESCE(Qa_wrd_count, 0) + 1) AS Qa_wc,
  (Qi_qab_wc - 1) AS Qi_wc,
  Ans_wc,
  COALESCE(Qa_pre_brdg, 0) AS QA_pb
FROM tep
WHERE
  Book_num <= 300 AND  --last question in match
  Book_num >= 73    --first question in match
ORDER BY Qq_wc ASC, Qa_wc ASC, Ques_ask ASC;
